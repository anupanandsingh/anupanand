<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="{{ .Description | default .Site.Params.Description }}">

    {{ if not .Site.Params.disableWebFonts }}
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    {{ end }}

    <title>
      {{ $url := replace .Permalink ( printf "%s" .Site.BaseURL) "" }}
      {{ if eq $url "/" }}
        {{ .Site.Title }}
      {{ else }}
        {{ if .Params.heading }} {{ .Params.heading }} {{ else }} {{ .Title }} {{ end }}
      {{ end }}
    </title>
    <link rel="canonical" href="{{ .Permalink }}">

    {{ partial "styles.html" . }}

    <link rel="icon" type="image/png" href="{{ "a-web.png" | relURL }}">
    <link rel="apple-touch-icon" href="{{ "a-web.png" | relURL }}">

    {{/* KaTeX for LaTeX math rendering (site or page level) */}}
    {{ if or .Params.math .Site.Params.math }}
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
      <script>
        window.addEventListener('DOMContentLoaded', function() {
          if (window.renderMathInElement) {
            window.renderMathInElement(document.body, {
              delimiters: [
                {left: '$$', right: '$$', display: true},
                {left: '$', right: '$', display: false},
                {left: '\\(', right: '\\)', display: false},
                {left: '\\[', right: '\\]', display: true}
              ],
              ignoredTags: ['script','noscript','style','textarea','pre','code']
            });
          }
        });
      </script>
    {{ end }}

    {{ range .AlternativeOutputFormats -}}
        {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
    {{ end -}}
  </head>

  <body>
    <section id=nav data-menu-open="false">
      <h1><a class="h-card" href="/">{{ .Site.Params.sitename }}</a></h1>
      <button id="menu-toggle" class="menu-toggle" aria-expanded="false" aria-controls="main-menu" title="Menu">
        <svg aria-hidden="true" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/></svg>
        Menu
      </button>
      <ul id="main-menu">
        {{ range .Site.Menus.main }}
          <li><a href="{{ .URL }}">{{ .Name }}</a></li>
        {{ end }}
        <li>
          <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme" aria-pressed="false" title="Toggle theme">
            <svg id="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
              <path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.8 1.42-1.42zm10.45 14.32l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM12 4V1h-0v3h0zm0 19v-3h0v3h0zM4 12H1v0h3v0zm19 0h-3v0h3v0zM6.76 19.16l-1.42 1.42-1.79-1.8 1.41-1.41 1.8 1.79zm13-13l-1.8 1.79-1.41-1.41 1.79-1.8 1.42 1.42zM12 8a4 4 0 100 8 4 4 0 000-8z"/>
            </svg>
            <svg id="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true" style="display:none">
              <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
          </button>
        </li>
      </ul>
    </section>
    <script>
      (function() {
        var key = 'theme';
        var root = document.documentElement;
        var sun = null, moon = null;
        var toggle = function(next) {
          root.setAttribute('data-theme', next);
          try { localStorage.setItem(key, next); } catch (e) {}
          var btn = document.getElementById('theme-toggle');
          if (btn) {
            btn.setAttribute('aria-pressed', next === 'dark');
            if (!sun) sun = document.getElementById('icon-sun');
            if (!moon) moon = document.getElementById('icon-moon');
            if (sun && moon) {
              if (next === 'dark') { sun.style.display = 'none'; moon.style.display = 'inline'; }
              else { sun.style.display = 'inline'; moon.style.display = 'none'; }
            }
          }
        };
        var saved = null;
        try { saved = localStorage.getItem(key); } catch (e) { saved = null; }
        if (saved === 'dark' || saved === 'light') {
          toggle(saved);
        } else {
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          toggle(prefersDark ? 'dark' : 'light');
        }
        var btnEl = document.getElementById('theme-toggle');
        if (btnEl) {
          btnEl.addEventListener('click', function() {
            var current = root.getAttribute('data-theme');
            var next = current === 'dark' ? 'light' : 'dark';
            toggle(next);
          });
        }
      })();
    </script>
    <script>
      (function(){
        var nav = document.getElementById('nav');
        var btn = document.getElementById('menu-toggle');
        var menu = document.getElementById('main-menu');
        if (!nav || !btn || !menu) return;
        btn.addEventListener('click', function(){
          var open = nav.getAttribute('data-menu-open') === 'true';
          var next = !open;
          nav.setAttribute('data-menu-open', String(next));
          btn.setAttribute('aria-expanded', String(next));
        });
      })();
    </script>
    <script>
      (function(){
        // Set target="_blank" for external links, keep internal links in same tab
        document.addEventListener('DOMContentLoaded', function() {
          var currentHost = window.location.hostname;
          var links = document.querySelectorAll('a');
          links.forEach(function(link) {
            var href = link.getAttribute('href');
            if (!href) return;
            
            // Check if it's an external link
            if (href.startsWith('http://') || href.startsWith('https://')) {
              try {
                var linkHost = new URL(href).hostname;
                if (linkHost !== currentHost) {
                  // External link - open in new tab
                  link.setAttribute('target', '_blank');
                  link.setAttribute('rel', 'noopener noreferrer');
                } else {
                  // Internal link to same domain - ensure it opens in same tab
                  link.removeAttribute('target');
                }
              } catch (e) {
                // Invalid URL, skip
              }
            } else {
              // Relative links - ensure they open in same tab
              link.removeAttribute('target');
            }
          });
        });
      })();
    </script>

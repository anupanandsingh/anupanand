<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
  <head>
    <meta charset="utf-8">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="{{ .Description | default .Site.Params.Description }}">

    {{ if not .Site.Params.disableWebFonts }}
      <link href="https://fonts.googleapis.com/css?family=Open+Sans:400|Old+Standard+TT:400&display=swap" rel="stylesheet" media="print" type="text/css" onload="this.media='all'">
    {{ end }}

    <title>
      {{ $url := replace .Permalink ( printf "%s" .Site.BaseURL) "" }}
      {{ if eq $url "/" }}
        {{ .Site.Title }}
      {{ else }}
        {{ if .Params.heading }} {{ .Params.heading }} {{ else }} {{ .Title }} {{ end }}
      {{ end }}
    </title>
    <link rel="canonical" href="{{ .Permalink }}">

    {{ partial "styles.html" . }}

    {{ range .AlternativeOutputFormats -}}
        {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
    {{ end -}}
  </head>

  <body>
    <section id=nav>
      <h1><a class="h-card" href="/">{{ .Site.Params.sitename }}</a></h1>
      <ul>
        {{ range .Site.Menus.main }}
          <li><a href="{{ .URL }}">{{ .Name }}</a></li>
        {{ end }}
        <li>
          <button id="theme-toggle" aria-label="Toggle theme" aria-pressed="false" style="background:none;border:0;cursor:pointer;font:inherit;text-decoration:underline">
            Toggle Theme
          </button>
        </li>
      </ul>
    </section>
    <script>
      (function() {
        var key = 'theme';
        var root = document.documentElement;
        var toggle = function(next) {
          root.setAttribute('data-theme', next);
          try { localStorage.setItem(key, next); } catch (e) {}
          var btn = document.getElementById('theme-toggle');
          if (btn) {
            btn.setAttribute('aria-pressed', next === 'dark');
            btn.textContent = next === 'dark' ? 'Light Mode' : 'Dark Mode';
          }
        };
        var saved = null;
        try { saved = localStorage.getItem(key); } catch (e) { saved = null; }
        if (saved === 'dark' || saved === 'light') {
          toggle(saved);
        } else {
          // No saved preference; initialize button label based on media query
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          var btn = document.getElementById('theme-toggle');
          if (btn) btn.textContent = prefersDark ? 'Light Mode' : 'Dark Mode';
        }
        var btnEl = document.getElementById('theme-toggle');
        if (btnEl) {
          btnEl.addEventListener('click', function() {
            var current = root.getAttribute('data-theme');
            var next = current === 'dark' ? 'light' : 'dark';
            toggle(next);
          });
        }
      })();
    </script>
